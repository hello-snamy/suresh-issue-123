<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </head>
  <body>
    <script>
      window.addEventListener('load', function() {
        // Check if we have a token
        const token = localStorage.getItem('githubToken');
        
        if (!token) {
          // Redirect to login if no token
          window.location.href = 'login.html';
          return;
        }

        // Initialize Decap CMS with our token
        window.CMS.init({
          config: {
            backend: {
              name: 'github',
              repo: 'hello-snamy/suresh-issue-123',
              branch: 'main'
            },
            load_config_file: false,
            media_folder: "images/uploads",
            public_folder: "/images/uploads",
            collections: [
              {
                name: "blog",
                label: "Blog Posts",
                folder: "posts",
                create: true,
                slug: "{{slug}}",
                fields: [
                  { label: "Title", name: "title", widget: "string" },
                  { label: "Publish Date", name: "date", widget: "datetime" },
                  { label: "Body", name: "body", widget: "markdown" }
                ]
              }
            ]
          }
        });

        // Override authentication to use our stored token
        const gitHubBackend = window.CMS.getBackend('github');
        if (gitHubBackend && gitHubBackend.authenticate) {
          gitHubBackend.authenticate = function() {
            return Promise.resolve({ token: token });
          };
        }
      });
    </script>
  </body>
</html>
